<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mehl-Finder Quiz - Pizza Toolkit</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Finde das perfekte Pizzamehl f√ºr deinen Stil mit unserem interaktiven Quiz">
    <meta name="theme-color" content="#eb4b23">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Fonts & Styles -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Matomo Tracking -->
    <!-- JavaScript -->
    <script src="flour-database.js"></script>
    <script>
        var _paq = window._paq = window._paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="../assets/js/matomo/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '1']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>

    <style>
        /* CSS Custom Properties */
        :root {
            --primary-color: #dc3545;
            --primary-dark: #c82333;
            --secondary-color: #e74c3c;
            --background: #f8f9fa;
            --surface: #ffffff;
            --surface-light: #f8f9fa;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --text-muted: #868e96;
            --border: #dee2e6;
            --success: #28a745;
            --warning: #ffc107;
            --error: #dc3545;
            --radius: 12px;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            padding-bottom: 80px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: calc(100vh - 80px);
        }

        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem 1rem;
        }

        .page-title {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-weight: 400;
        }

        /* Quiz Container */
        .quiz-container {
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        /* Progress Bar - entfernt */

        /* Quiz Content */
        .quiz-content {
            padding: 2rem 1.5rem;
        }

        .question-container {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .question-container.active {
            display: block;
        }

        .question-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .question-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .question-description {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        /* Answer Options */
        .answers-grid {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .answer-option {
            background: var(--surface-light);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .answer-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(220, 53, 69, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .answer-option:hover::before {
            left: 100%;
        }

        .answer-option:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(220, 53, 69, 0.3);
        }

        .answer-option.selected {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-color: var(--primary-color);
            color: var(--text-primary);
            transform: scale(1.02);
        }

        .answer-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .answer-emoji {
            font-size: 2.5rem;
            flex-shrink: 0;
        }

        .answer-text {
            flex: 1;
        }

        .answer-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
            color: inherit;
        }

        .answer-description {
            font-size: 0.9rem;
            opacity: 0.8;
            color: inherit;
        }

        .answer-option.selected .answer-description {
            opacity: 1;
        }

        /* Navigation */
        .quiz-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            background: var(--surface-light);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-primary);
            border: none;
            padding: 0.75rem 2rem;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            min-height: 48px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(220, 53, 69, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: var(--surface-light);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        /* Results */
        .results-container {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .results-container.active {
            display: block;
        }

        .results-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .results-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .results-explanation {
            font-size: 1.1rem;
            color: var(--text-secondary);
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }

        .flour-recommendations {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .flour-card {
            background: var(--surface-light);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 2rem;
            transition: var(--transition);
        }

        .flour-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(220, 53, 69, 0.2);
            border-color: var(--primary-color);
        }

        .flour-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .flour-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .flour-brand {
            font-size: 0.9rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .flour-specs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .flour-spec {
            background: var(--surface);
            padding: 0.75rem;
            border-radius: var(--radius);
            text-align: center;
            border: 1px solid var(--border);
        }

        .flour-spec-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
            display: block;
        }

        .flour-spec-value {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        .flour-description {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .buy-button {
            width: 100%;
            justify-content: center;
            margin-top: 1rem;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 10px 0 calc(10px + env(safe-area-inset-bottom));
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-muted);
            transition: var(--transition);
            padding: 5px;
            min-width: 0;
            flex: 1;
        }

        .nav-item:hover {
            color: var(--primary-color);
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        .nav-icon {
            font-size: 1.5rem;
            margin-bottom: 2px;
        }

        .nav-text {
            font-size: 0.7rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        /* Footer Link */
        .footer-link {
            text-align: center;
            margin-top: 2rem;
            padding: 1rem;
        }

        .footer-link p {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .footer-link a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .quiz-content {
                padding: 1.5rem 1rem;
            }

            .flour-specs {
                grid-template-columns: repeat(2, 1fr);
            }

            .quiz-navigation {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .nav-text {
                font-size: 0.65rem;
            }

            .nav-icon {
                font-size: 1.3rem;
            }
        }

        @media (max-width: 480px) {
            .answer-content {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }

            .answer-emoji {
                font-size: 2rem;
            }

            .flour-header {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Page Header -->
        <header class="page-header">
            <h1 class="page-title">üåæ Mehl-Finder</h1>
            <p class="page-subtitle">Finde das perfekte Pizzamehl f√ºr deinen Stil</p>
        </header>

        <!-- Quiz Container -->
        <div class="quiz-container">
            <!-- Progress wird entfernt - kein Code hier -->

            <div class="quiz-content">
                <!-- Frage 1: Back-Level -->
                <div class="question-container active" id="question1">
                    <div class="question-header">
                        <h2 class="question-title">Wie w√ºrdest du dein Back-Level einsch√§tzen?</h2>
                        <p class="question-description">Deine Erfahrung hilft uns, die richtige Mehl-Empfehlung zu finden</p>
                    </div>
                    
                    <div class="answers-grid">
                        <div class="answer-option" data-value="beginner">
                            <div class="answer-content">
                                <span class="answer-emoji">üå±</span>
                                <div class="answer-text">
                                    <div class="answer-title">Einsteiger</div>
                                    <div class="answer-description">Ich backe gelegentlich und suche einfache L√∂sungen</div>
                                </div>
                            </div>
                        </div>
                        <div class="answer-option" data-value="intermediate">
                            <div class="answer-content">
                                <span class="answer-emoji">üî•</span>
                                <div class="answer-text">
                                    <div class="answer-title">Fortgeschritten</div>
                                    <div class="answer-description">Ich habe schon √∂fter Pizza gebacken und experimentiere gerne</div>
                                </div>
                            </div>
                        </div>
                        <div class="answer-option" data-value="expert">
                            <div class="answer-content">
                                <span class="answer-emoji">üë®‚Äçüç≥</span>
                                <div class="answer-text">
                                    <div class="answer-title">Profi</div>
                                    <div class="answer-description">Ich kenne mich gut aus und suche Spitzenergebnisse</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Frage 2: G√§rzeit -->
                <div class="question-container" id="question2">
                    <div class="question-header">
                        <h2 class="question-title">Wie viel Zeit hast du f√ºr die Teigf√ºhrung?</h2>
                        <p class="question-description">Die G√§rzeit bestimmt ma√ügeblich die Wahl des richtigen Mehls</p>
                    </div>
                    
                    <div class="answers-grid">
                        <div class="answer-option" data-value="short">
                            <div class="answer-content">
                                <span class="answer-emoji">‚ö°</span>
                                <div class="answer-text">
                                    <div class="answer-title">Wenige Stunden</div>
                                    <div class="answer-description">2-6 Stunden - schnelle Pizza f√ºr heute</div>
                                </div>
                            </div>
                        </div>
                        <div class="answer-option" data-value="medium">
                            <div class="answer-content">
                                <span class="answer-emoji">üïê</span>
                                <div class="answer-text">
                                    <div class="answer-title">24 Stunden</div>
                                    <div class="answer-description">√úber Nacht gehen lassen</div>
                                </div>
                            </div>
                        </div>
                        <div class="answer-option" data-value="long">
                            <div class="answer-content">
                                <span class="answer-emoji">‚è≥</span>
                                <div class="answer-text">
                                    <div class="answer-title">48+ Stunden</div>
                                    <div class="answer-description">Lange, kalte F√ºhrung f√ºr besten Geschmack</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Frage 3: Ofentyp -->
                <div class="question-container" id="question3">
                    <div class="question-header">
                        <h2 class="question-title">In welchem Ofen backst du deine Pizza?</h2>
                        <p class="question-description">Der Ofentyp beeinflusst Temperatur und Backzeit</p>
                    </div>
                    
                    <div class="answers-grid">
                        <div class="answer-option" data-value="home">
                            <div class="answer-content">
                                <span class="answer-emoji">üè†</span>
                                <div class="answer-text">
                                    <div class="answer-title">Haushaltsofen</div>
                                    <div class="answer-description">Standard Backofen bis 250¬∞C</div>
                                </div>
                            </div>
                        </div>
                        <div class="answer-option" data-value="ooni">
                            <div class="answer-content">
                                <span class="answer-emoji">üî•</span>
                                <div class="answer-text">
                                    <div class="answer-title">Ooni / Outdoor-Ofen</div>
                                    <div class="answer-description">Portable Pizza√∂fen bis 400¬∞C+</div>
                                </div>
                            </div>
                        </div>
                        <div class="answer-option" data-value="grill">
                            <div class="answer-content">
                                <span class="answer-emoji">üçñ</span>
                                <div class="answer-text">
                                    <div class="answer-title">Grill</div>
                                    <div class="answer-description">Gas- oder Holzkohlegrill mit Pizzastein</div>
                                </div>
                            </div>
                        </div>
                        <div class="answer-option" data-value="effeuno">
                            <div class="answer-content">
                                <span class="answer-emoji">‚ö°</span>
                                <div class="answer-text">
                                    <div class="answer-title">Effeuno / Profi-Ofen</div>
                                    <div class="answer-description">Elektrischer Pizzaofen bis 510¬∞C</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Frage 4: Pizza-Style -->
                <div class="question-container" id="question4">
                    <div class="question-header">
                        <h2 class="question-title">Welchen Pizza-Style bevorzugst du?</h2>
                        <p class="question-description">Jeder Stil hat seine eigenen Anforderungen an das Mehl</p>
                    </div>
                    
                    <div class="answers-grid">
                        <div class="answer-option" data-value="napoletana">
                            <div class="answer-content">
                                <span class="answer-emoji">üáÆüáπ</span>
                                <div class="answer-text">
                                    <div class="answer-title">Napoletana</div>
                                    <div class="answer-description">D√ºnner Boden, hoher Rand, sehr hei√ü gebacken</div>
                                </div>
                            </div>
                        </div>
                        <div class="answer-option" data-value="romana">
                            <div class="answer-content">
                                <span class="answer-emoji">üçï</span>
                                <div class="answer-text">
                                    <div class="answer-title">Romana</div>
                                    <div class="answer-description">D√ºnn und knusprig, gleichm√§√üiger Boden</div>
                                </div>
                            </div>
                        </div>
                        <div class="answer-option" data-value="pinsa">
                            <div class="answer-content">
                                <span class="answer-emoji">üåæ</span>
                                <div class="answer-text">
                                    <div class="answer-title">Pinsa Romana</div>
                                    <div class="answer-description">Ovale Form, luftig-leicht, l√§ngere G√§rung</div>
                                </div>
                            </div>
                        </div>
                        <div class="answer-option" data-value="detroit">
                            <div class="answer-content">
                                <span class="answer-emoji">üü©</span>
                                <div class="answer-text">
                                    <div class="answer-title">Detroit Style</div>
                                    <div class="answer-description">Eckige Form, fluffiger Teig, viel K√§se</div>
                                </div>
                            </div>
                        </div>
                        <div class="answer-option" data-value="deep">
                            <div class="answer-content">
                                <span class="answer-emoji">ü•ß</span>
                                <div class="answer-text">
                                    <div class="answer-title">Deep Dish</div>
                                    <div class="answer-description">Dicke Kruste, wie ein Kuchen mit Belag</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ergebnisse -->
                <div class="results-container" id="results">
                    <div class="results-header">
                        <h2 class="results-title">Deine perfekten Mehle! üéØ</h2>
                        <div class="results-explanation" id="resultsExplanation"></div>
                    </div>
                    <div class="flour-recommendations" id="flourRecommendations"></div>
                </div>
            </div>

            <div class="quiz-navigation">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" style="display: none;">
                    ‚Üê Zur√ºck
                </button>
                <button class="btn" id="nextBtn" onclick="nextQuestion()">
                    Weiter ‚Üí
                </button>
                <button class="btn" id="restartBtn" onclick="restartQuiz()" style="display: none;">
                    üîÑ Quiz wiederholen
                </button>
            </div>
        </div>

        <div class="footer-link">
            <p>Made with üçï by <a href="https://www.salamico.de" target="_blank">Salamico</a></p>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">        
        <a href="../teigrechner/" class="nav-item" data-track="nav_teigrechner">
            <div class="nav-icon">üßÆ</div>
            <div class="nav-text">Teigrechner</div>
        </a>
        
        <a href="#" class="nav-item active" data-track="nav_mehl_guide">
            <div class="nav-icon">üåæ</div>
            <div class="nav-text">Mehl-Guide</div>
        </a>
        
        <a href="../equipment/" class="nav-item" data-track="nav_equipment">
            <div class="nav-icon">üî•</div>
            <div class="nav-text">Equipment</div>
        </a>
        
        <a href="../zutaten/" class="nav-item" data-track="nav_zutaten">
            <div class="nav-icon">üçÖ</div>
            <div class="nav-text">Zutaten</div>
        </a>
        
        <a href="../quiz/" class="nav-item" data-track="nav_pizza_quiz">
            <div class="nav-icon">üçï</div>
            <div class="nav-text">Pizza-Quiz</div>
        </a>
        
        <a href="../wissen/" class="nav-item" data-track="nav_pizza_wissen">
            <div class="nav-icon">üìö</div>
            <div class="nav-text">Pizza-Wissen</div>
        </a>
    </nav>

    <script>
        let currentQuestion = 1;
        let answers = {};
        const totalQuestions = 4;

        // Mehl-Datenbank wird aus flour-database.js geladen
        // Falls die externe Datei nicht geladen wurde, Fallback-Datenbank
        if (typeof flourDatabase === 'undefined') {
            console.warn('flour-database.js nicht geladen - verwende Fallback-Datenbank');
            window.flourDatabase = {
                'fallback_mehl': {
                    name: 'Standard Pizzamehl',
                    brand: 'Generic',
                    wValue: '280',
                    protein: '12g',
                    hydration: '60%',
                    description: 'Universelles Pizzamehl f√ºr alle Gelegenheiten.',
                    buyLink: '#',
                    styles: ['napoletana', 'romana'],
                    ovenTypes: ['home', 'ooni'],
                    fermentation: ['medium']
                }
            };
        }

        // Quiz-Logik
        function selectAnswer(questionNum, value) {
            const currentOptions = document.querySelectorAll(`#question${questionNum} .answer-option`);
            currentOptions.forEach(option => option.classList.remove('selected'));
            
            const selectedOption = document.querySelector(`#question${questionNum} .answer-option[data-value="${value}"]`);
            selectedOption.classList.add('selected');
            
            answers[questionNum] = value;
            document.getElementById('nextBtn').disabled = false;
            
            // Tracking
            if (typeof _paq !== 'undefined') {
                _paq.push(['trackEvent', 'Quiz', 'Answer', `Q${questionNum}_${value}`]);
            }
        }

        function nextQuestion() {
            if (!answers[currentQuestion]) return;

            if (currentQuestion === totalQuestions) {
                showResults();
                return;
            }

            document.getElementById(`question${currentQuestion}`).classList.remove('active');
            currentQuestion++;
            document.getElementById(`question${currentQuestion}`).classList.add('active');
            
            updateProgress();
            updateNavigation();
        }

        function previousQuestion() {
            if (currentQuestion === 1) return;
            
            document.getElementById(`question${currentQuestion}`).classList.remove('active');
            currentQuestion--;
            document.getElementById(`question${currentQuestion}`).classList.add('active');
            
            updateProgress();
            updateNavigation();
        }

        function updateProgress() {
            // Progress wird nicht mehr angezeigt - Funktion leer
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const restartBtn = document.getElementById('restartBtn');
            
            prevBtn.style.display = currentQuestion === 1 ? 'none' : 'inline-flex';
            nextBtn.disabled = !answers[currentQuestion];
            nextBtn.textContent = currentQuestion === totalQuestions ? 'Ergebnis anzeigen üéØ' : 'Weiter ‚Üí';
            
            if (currentQuestion === totalQuestions && answers[currentQuestion]) {
                nextBtn.style.display = 'inline-flex';
                restartBtn.style.display = 'none';
            }
        }

        // Empfehlungs-Algorithmus
        function getRecommendations() {
            const level = answers[1]; // beginner, intermediate, expert
            const fermentation = answers[2]; // short, medium, long
            const oven = answers[3]; // home, ooni, grill, effeuno
            const style = answers[4]; // napoletana, romana, pinsa, detroit, deep

            let recommendations = [];

            Object.values(flourDatabase).forEach(flour => {
                let score = 0;

                // G√§rzeit-Matching (wichtigster Faktor)
                if (flour.fermentation.includes(fermentation)) {
                    score += 3;
                }

                // Stil-Matching
                if (flour.styles.includes(style)) {
                    score += 2;
                }

                // Ofen-Matching
                if (flour.ovenTypes.includes(oven)) {
                    score += 2;
                }

                // Level-Anpassung
                if (level === 'beginner' && parseInt(flour.wValue) < 280) {
                    score += 1;
                } else if (level === 'expert' && parseInt(flour.wValue) >= 300) {
                    score += 1;
                }

                if (score >= 4) {
                    recommendations.push({ flour, score });
                }
            });

            // Fallback: Falls keine Treffer, zeige die besten verf√ºgbaren
            if (recommendations.length === 0) {
                Object.values(flourDatabase).forEach(flour => {
                    let score = 0;
                    if (flour.fermentation.includes(fermentation)) score += 2;
                    if (flour.styles.includes(style)) score += 1;
                    if (flour.ovenTypes.includes(oven)) score += 1;
                    recommendations.push({ flour, score });
                });
            }

            recommendations.sort((a, b) => b.score - a.score);
            return recommendations.slice(0, 3).map(r => r.flour);
        }

        function showResults() {
            document.querySelectorAll('.question-container').forEach(q => q.classList.remove('active'));
            
            const recommendations = getRecommendations();
            
            // Tracking
            if (typeof _paq !== 'undefined') {
                _paq.push(['trackEvent', 'Quiz', 'Complete', `${answers[1]}_${answers[2]}_${answers[3]}_${answers[4]}`]);
            }
            
            // Erkl√§rungstext
            const explanationText = generateExplanation();
            document.getElementById('resultsExplanation').innerHTML = explanationText;
            
            // Mehl-Empfehlungen
            const recommendationsHtml = recommendations.map(flour => `
                <div class="flour-card">
                    <div class="flour-header">
                        <div>
                            <div class="flour-name">${flour.name}</div>
                            <div class="flour-brand">${flour.brand}</div>
                        </div>
                    </div>
                    <div class="flour-specs">
                        <div class="flour-spec">
                            <span class="flour-spec-label">W-Wert</span>
                            <span class="flour-spec-value">${flour.wValue}</span>
                        </div>
                        <div class="flour-spec">
                            <span class="flour-spec-label">Protein</span>
                            <span class="flour-spec-value">${flour.protein}</span>
                        </div>
                        <div class="flour-spec">
                            <span class="flour-spec-label">Hydration</span>
                            <span class="flour-spec-value">${flour.hydration}</span>
                        </div>
                    </div>
                    <div class="flour-description">${flour.description}</div>
                    <a href="${flour.buyLink}" class="btn buy-button" target="_blank" rel="noopener" data-track="buy_${flour.name.toLowerCase().replace(/\s+/g, '_')}">
                        üõí Jetzt kaufen
                    </a>
                </div>
            `).join('');
            
            document.getElementById('flourRecommendations').innerHTML = recommendationsHtml;
            document.getElementById('results').classList.add('active');
            
            // Navigation anpassen
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('prevBtn').style.display = 'none';
            document.getElementById('restartBtn').style.display = 'inline-flex';
        }

        function generateExplanation() {
            const level = answers[1];
            const fermentation = answers[2];
            const oven = answers[3];
            const style = answers[4];

            const levelTexts = {
                'beginner': 'Als Einsteiger',
                'intermediate': 'Mit deiner Erfahrung',
                'expert': 'Als Profi'
            };

            const fermentationTexts = {
                'short': 'kurzer G√§rzeit',
                'medium': '24h G√§rzeit',
                'long': 'langer G√§rung (48h+)'
            };

            const styleTexts = {
                'napoletana': 'neapolitanische Pizza',
                'romana': 'r√∂mische Pizza',
                'pinsa': 'Pinsa Romana',
                'detroit': 'Detroit Style Pizza',
                'deep': 'Deep Dish Pizza'
            };

            const ovenTexts = {
                'home': 'deinem Haushaltsofen',
                'ooni': 'deinem Ooni/Outdoor-Ofen',
                'grill': 'deinem Grill',
                'effeuno': 'deinem Profi-Ofen'
            };

            return `${levelTexts[level]} und deiner Vorliebe f√ºr ${styleTexts[style]} mit ${fermentationTexts[fermentation]} in ${ovenTexts[oven]} haben wir diese Mehle f√ºr dich ausgew√§hlt. Sie passen perfekt zu deinem Setup und deinen Anforderungen! üéØ`;
        }

        function restartQuiz() {
            currentQuestion = 1;
            answers = {};
            
            document.querySelectorAll('.question-container').forEach(q => q.classList.remove('active'));
            document.getElementById('question1').classList.add('active');
            document.getElementById('results').classList.remove('active');
            
            document.querySelectorAll('.answer-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            document.getElementById('nextBtn').style.display = 'inline-flex';
            document.getElementById('restartBtn').style.display = 'none';
            
            updateProgress();
            updateNavigation();
            
            // Tracking
            if (typeof _paq !== 'undefined') {
                _paq.push(['trackEvent', 'Quiz', 'Restart']);
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.answer-option').forEach(option => {
                option.addEventListener('click', function() {
                    const value = this.getAttribute('data-value');
                    selectAnswer(currentQuestion, value);
                });
            });

            // Bottom Navigation Tracking
            document.querySelectorAll('.nav-item[data-track]').forEach(item => {
                item.addEventListener('click', function() {
                    const trackingCode = this.getAttribute('data-track');
                    if (typeof _paq !== 'undefined') {
                        _paq.push(['trackEvent', 'Navigation', 'Click', trackingCode]);
                    }
                });
            });

            // Buy Button Tracking
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('buy-button')) {
                    const trackingCode = e.target.getAttribute('data-track');
                    if (typeof _paq !== 'undefined' && trackingCode) {
                        _paq.push(['trackEvent', 'Purchase', 'Click', trackingCode]);
                    }
                }
            });
        });

        // Initialize
        updateProgress();
        updateNavigation();
    </script>
</body>
</html>